<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script type="text/javascript" src="layui/layui.js"></script>
    <script type="text/javascript" src="js/config.js"></script>
    <link rel="stylesheet" href="layui/css/layui.css" />
    <link rel="stylesheet" href="css/user.css" />
    <ul class="layui-nav nav-left" lay-filter="">
        <div class="home">
            <li class="layui-nav-item item"><a href="index.html" class="layui-icon layui-icon-home"> 首页</a></li>
        </div>
    </ul>
    <ul class="layui-nav nav-right" lay-filter="user">
        <div class="login" id="login">
            <li class="layui-nav-item item-left">
                <a href="login.html">登录</a>
            </li>
            <li class="layui-nav-item item-left">
                <a href="register.html">注册</a>
            </li>
        </div>
        <div class="login" id="myInfo">
            <li class="layui-nav-item item-left"><a href="javascript:;" id="username">我的</a>
                <dl class="layui-nav-child child">
                    <dd><a href="user.html">我的简历</a></dd>
                    <dd><a href="cartAndCollection.html#lay-id=collection">投递记录</a></dd>
                    <dd><a href="javascript:;" id="logout">退出登录</a></dd>
                </dl>
            </li>
        </div>
    </ul>
    </div><br>
    <form class="layui-form form" action="" id="form" lay-filter="form">
        <div class="base-info">
            <blockquote class="layui-elem-quote">基本信息</blockquote>
            <div class="layui-form-item" hidden>
                <input type="text" name="username" placeholder="请输入姓名" autocomplete="off"
                    class="layui-input" id="user">
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">姓名</label>
                <div class="layui-input-inline name">
                    <input type="text" name="name" required lay-verify="required" placeholder="请输入姓名" autocomplete="off"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-form-item sex">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-inline">
                    <input type="radio" name="sex" value="男" title="男">
                    <input type="radio" name="sex" value="女" title="女" checked>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">电话号码</label>
                <div class="layui-input-inline name">
                    <input type="text" name="telephone" required lay-verify="required" placeholder="请输入手机号"
                        autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">邮箱地址</label>
                <div class="layui-input-inline name">
                    <input type="text" name="email" required lay-verify="required" placeholder="请输入邮箱地址"
                        autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">期望薪资</label>
                <div class="layui-input-inline" style="width: 150px;">
                    <input type="text" name="salaryExpectation" required lay-verify="required" placeholder="请输入期望薪资"
                        autocomplete="off" class="layui-input">
                </div>
                <label class="layui-form-label month">元/月</label>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">个人介绍</label>
                <div class="layui-input-block">
                    <textarea name="personalIntroduction" placeholder="请输入内容" class="layui-textarea"></textarea>
                </div>
            </div>
        </div>
        <div class="work-experience" id="work-experience">
            <blockquote class="layui-elem-quote">工作经历</blockquote>
            <div class="layui-form-item">
                <label class="layui-form-label">公司名称</label>
                <div class="layui-input-block">
                    <input type="text" name="companyName" required lay-verify="required" placeholder="请输入公司名称"
                        autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item"">
                <label class=" layui-form-label">起始时间</label>
                <div class="layui-input-inline time">
                    <input type="text" name="startTime" required lay-verify="required" placeholder="开始时间"
                        autocomplete="off" class="layui-input time layui-input-inline" id="startTime">
                </div>
                <div class="layui-input-inline icon">-</div>
                <div class="layui-input-inline time">
                    <input type="text" name="endTime" required lay-verify="required" placeholder="结束时间"
                        autocomplete="off" class="layui-input time layui-input-inline" id="endTime">
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">工作介绍</label>
                <div class="layui-input-block">
                    <textarea name="workDescribe" placeholder="请输入内容" class="layui-textarea"></textarea>
                </div>
            </div>
            <div class="add" id="add-div">
                <button class="layui-icon layui-icon-add-circle add-circle" id="add"></button>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block button">
                <button class="layui-btn" id="submit" lay-filter="save" lay-submit onclick="return false">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary reset">重置</button>
            </div>
        </div>
    </form>
    <button class="layui-btn" id="uploadHidden" onclick="return false" style="VISIBILITY: hidden">上传</button>
    <div class="img">
        <div class="img-preview" id="img-preview">
            <i class="layui-icon layui-icon-add-1 preview"></i>
        </div>
        <div class="upload">
            <button class="layui-btn" id="upload">
                <i class="layui-icon">&#xe67c;</i>上传图片
            </button>
        </div>
    </div>
    <script>
        //Demo
        layui.use(['form', 'laydate', 'upload', 'layer'], function () {
            var $ = layui.$,
                form = layui.form,
                laydate = layui.laydate,
                jquery = layui.jquery,
                upload = layui.upload,
                layer = layui.layer;
            var user = sessionStorage.getItem("username");
            // var myInfo = '<li class="layui-nav-item item-left"><a href="javascript:;">我的</a></li>'
            if (user != null) {
                document.getElementById("login").style.display = "none"; //隐藏
                document.getElementById("myInfo").style.display = ""; //显示
                document.getElementById("username").innerHTML = user;
            } else {
                document.getElementById("myInfo").style.display = "none"; //隐藏
                document.getElementById("login").style.display = ""; //显示
            }
            //监听提交
            form.on('submit(formDemo)', function (data) {
                layer.msg(JSON.stringify(data.field));
                return false;
            });
            laydate.render({
                elem: '#startTime'
            });

            laydate.render({
                elem: '#endTime'
            });
            $(document).on('click', '#add', function () {
                jquery("#work-experience").append('<div class="layui-form-item"><label class="layui-form-label">公司名称</label><div class="layui-input-block"><input type="text" name="companyName" required lay-verify="required" placeholder="请输入公司名称" autocomplete="off" class="layui-input"></div></div><div class="layui-form-item" id="work-experience"><label class="layui-form-label">起始时间</label><div class="layui-input-inline time"><input type="text" name="startTime" required lay-verify="required" placeholder="开始时间" autocomplete="off" class="layui-input time layui-input-inline" id="startTime"></div><div class="layui-input-inline icon">-</div><div class="layui-input-inline time"><input type="text" name="endTime" required lay-verify="required" placeholder="结束时间" autocomplete="off" class="layui-input time layui-input-inline" id="endTime"></div></div><div class="layui-form-item layui-form-text"><label class="layui-form-label">工作介绍</label><div class="layui-input-block"><textarea name="workDescribe" placeholder="请输入内容" class="layui-textarea"></textarea></div></div>');
                laydate.render({
                    elem: '.time'
                })
                return false;
            });
            // var user = window.top.document.getElementById("user").innerHTML;
            form.val("form", { //formTest 即 class="layui-form" 所在元素属性 lay-filter="" 对应的值
                "username": sessionStorage.getItem("username") // "name": "value"
            });
            form.on('submit(save)', function (data) {
                var dataJson = $("#form").serialize();
                // console.log('json',dataJson);
                $.post('user/resume', dataJson, function (res) {
                    if (res.responseCode == "0000") {
                        $('#uploadHidden').trigger('click');
                        // layer.msg("保存成功")
                    } else {
                        layer.open({
                            title: '提示',
                            content: res.message,
                            anim: 6
                        });

                    }
                });
                return false; // require
            });
            upload.render({
                elem: '#upload' //绑定元素
                , url: 'user/photo' //上传接口
                , auto: false
                , bindAction: '#uploadHidden'
                // , before: function (res) {
                //     layer.msg(load)
                // }
                , choose: function (obj) {
                    obj.preview(function (index, file, result) {
                        document.getElementById("img-preview").innerHTML = '<img src=' + result + ' width="125px" height="175px" id="img"><br>'
                        console.log(result); //得到文件base64编码，比如图片
                    });
                }
                , done: function (res) {
                    layer.msg("保存成功")
                }
                , error: function () {
                    //请求异常回调
                }

            });
        });
    </script>
</body>

</html>